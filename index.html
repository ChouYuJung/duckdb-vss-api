
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A high-performance vector similarity search API powered by DuckDB and OpenAI embeddings.">
      
      
        <meta name="author" content="allen2c">
      
      
        <link rel="canonical" href="https://allen2c.github.io/dvs/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.47">
    
    
      
        <title>DVS</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dvs-duckdb-vector-similarity-search-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="DVS" class="md-header__button md-logo" aria-label="DVS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DVS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DVS - DuckDB Vector Similarity Search API
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/allen2c/dvs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    allen2c/dvs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="DVS" class="md-nav__button md-logo" aria-label="DVS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DVS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/allen2c/dvs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    allen2c/dvs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    DVS - DuckDB Vector Similarity Search API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    DVS - DuckDB Vector Similarity Search API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-database-from-scratch" class="md-nav__link">
    <span class="md-ellipsis">
      Build database from scratch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-in-api-server" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in API Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      License
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-database-from-scratch" class="md-nav__link">
    <span class="md-ellipsis">
      Build database from scratch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-in-api-server" class="md-nav__link">
    <span class="md-ellipsis">
      Usage in API Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      License
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="dvs-duckdb-vector-similarity-search-api">DVS - DuckDB Vector Similarity Search API</h1>
<p>A high-performance vector similarity search API powered by DuckDB and OpenAI embeddings.</p>
<hr />
<p><strong>Documentation</strong>: <a href="https://allen2c.github.io/dvs/">https://allen2c.github.io/dvs/</a></p>
<p><strong>Source Code</strong>: <a href="https://github.com/allen2c/dvs">https://github.com/allen2c/dvs</a></p>
<hr />
<h2 id="overview">Overview</h2>
<p>DVS (DuckDB-VSS-API) is a FastAPI-based web service that provides efficient vector similarity search capabilities using DuckDB as the backend database and OpenAI's embedding models for vector representation. This project is designed for applications requiring fast similarity search capabilities, such as recommendation systems, semantic search engines, and content discovery platforms.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li>Single and bulk vector similarity searches</li>
<li>Caching of embeddings for improved performance</li>
<li>Support for both text queries and pre-computed vector embeddings</li>
<li>Configurable search parameters (e.g., top-k results, embedding inclusion)</li>
<li>Integration with OpenAI's latest embedding models</li>
</ul>
<h2 id="architecture">Architecture</h2>
<pre class="mermaid"><code>sequenceDiagram
    participant Client
    participant FastAPI
    participant Cache
    participant OpenAI
    participant DuckDB

    Client-&gt;&gt;FastAPI: Send search request
    FastAPI-&gt;&gt;Cache: Check for cached embedding
    alt Embedding in cache
        Cache--&gt;&gt;FastAPI: Return cached embedding
    else Embedding not in cache
        FastAPI-&gt;&gt;OpenAI: Generate embedding
        OpenAI--&gt;&gt;FastAPI: Return embedding
        FastAPI-&gt;&gt;Cache: Store new embedding
    end
    FastAPI-&gt;&gt;DuckDB: Perform vector search
    DuckDB--&gt;&gt;FastAPI: Return search results
    FastAPI-&gt;&gt;Client: Send search response</code></pre>
<h2 id="installation">Installation</h2>
<ol>
<li>Install from PyPI:
   <div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>dvs-py
</code></pre></div></li>
</ol>
<h2 id="usage">Usage</h2>
<h3 id="build-database-from-scratch">Build database from scratch</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>

<span class="kn">from</span> <span class="nn">dvs</span> <span class="kn">import</span> <span class="n">DVS</span>
<span class="kn">from</span> <span class="nn">dvs.types.document</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="n">dvs</span> <span class="o">=</span> <span class="n">DVS</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.duckdb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Add document to the database</span>
<span class="n">dvs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apple has announced new features for its upcoming iPhone, including an upgraded camera system and a new A16 chip for faster processing. The introduction of &quot;Focus Mode&quot; will allow users to customize notifications based on their activities.</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># noqa: E501</span>
<span class="p">)</span>
<span class="c1"># Bulk add documents to the database</span>
<span class="n">dvs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">Document</span><span class="o">.</span><span class="n">from_content</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Microsoft Expands Cloud Services with Azure Updates&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Microsoft has updated its Azure cloud services with enhanced AI and machine learning tools, along with new security features for data protection. These improvements aim to help businesses innovate and scale their operations more effectively.&quot;</span><span class="p">,</span>  <span class="c1"># noqa: E501</span>
        <span class="p">),</span>
        <span class="n">Document</span><span class="o">.</span><span class="n">from_content</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Google Introduces New AI Tools for Workspace&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Google has launched new AI tools for Workspace, including smart compose in Docs and advanced data analysis in Sheets. These features are designed to streamline workflows and enhance productivity for users.&quot;</span><span class="p">,</span>  <span class="c1"># noqa: E501</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DuckDB database path: </span><span class="si">{</span><span class="n">dvs</span><span class="o">.</span><span class="n">db_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Query the database</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dvs</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;What are the new features of the iPhone?&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="c1"># [</span>
<span class="c1">#     (</span>
<span class="c1">#         Point(</span>
<span class="c1">#             point_id=&quot;pt-8803e5df-c9df-4b01-9ce4-0b96217bf1f6&quot;,</span>
<span class="c1">#             document_id=&quot;doc-b87f979a-b994-42c3-aa7f-70b76ff97da4&quot;,</span>
<span class="c1">#             content_md5=&quot;14c88c0886f1ed68629303cf11270885&quot;,</span>
<span class="c1">#             embedding=[],</span>
<span class="c1">#             metadata={},</span>
<span class="c1">#         ),</span>
<span class="c1">#         Document(</span>
<span class="c1">#             document_id=&quot;doc-b87f979a-b994-42c3-aa7f-70b76ff97da4&quot;,</span>
<span class="c1">#             name=&quot;Apple has announced new feat&quot;,</span>
<span class="c1">#             content=&quot;Apple has announced new features for its upcoming iPhone ...&quot;,</span>
<span class="c1">#             content_md5=&quot;14c88c0886f1ed68629303cf11270885&quot;,</span>
<span class="c1">#             metadata={&quot;content_length&quot;: 239},</span>
<span class="c1">#             created_at=1733470507,</span>
<span class="c1">#             updated_at=1733470507,</span>
<span class="c1">#         ),</span>
<span class="c1">#         0.6913947463035583,</span>
<span class="c1">#     ),</span>
<span class="c1">#     (</span>
<span class="c1">#         Point(</span>
<span class="c1">#             point_id=&quot;pt-310b0550-b6c0-49fd-897f-fbc59f28e1f3&quot;,</span>
<span class="c1">#             document_id=&quot;doc-958469dd-e1c9-4ead-8620-b730ce51220b&quot;,</span>
<span class="c1">#             content_md5=&quot;79d8a6366ec174987672ec850af072d8&quot;,</span>
<span class="c1">#             embedding=[],</span>
<span class="c1">#             metadata={},</span>
<span class="c1">#         ),</span>
<span class="c1">#         Document(</span>
<span class="c1">#             document_id=&quot;doc-958469dd-e1c9-4ead-8620-b730ce51220b&quot;,</span>
<span class="c1">#             name=&quot;Microsoft Expands Cloud Services with Azure Updates&quot;,</span>
<span class="c1">#             content=&quot;Microsoft has updated its Azure cloud services ...&quot;,</span>
<span class="c1">#             content_md5=&quot;79d8a6366ec174987672ec850af072d8&quot;,</span>
<span class="c1">#             metadata={},</span>
<span class="c1">#             created_at=None,</span>
<span class="c1">#             updated_at=None,</span>
<span class="c1">#         ),</span>
<span class="c1">#         0.27888885140419006,</span>
<span class="c1">#     ),</span>
<span class="c1">#     (</span>
<span class="c1">#         Point(</span>
<span class="c1">#             point_id=&quot;pt-b4f5f590-2040-44e1-b79f-26ee05f8a9cc&quot;,</span>
<span class="c1">#             document_id=&quot;doc-2f43a241-e9e0-46b6-8df2-cc1898a13f14&quot;,</span>
<span class="c1">#             content_md5=&quot;3a9a118392776e9dbcb4f6feb43dbaf0&quot;,</span>
<span class="c1">#             embedding=[],</span>
<span class="c1">#             metadata={},</span>
<span class="c1">#         ),</span>
<span class="c1">#         Document(</span>
<span class="c1">#             document_id=&quot;doc-2f43a241-e9e0-46b6-8df2-cc1898a13f14&quot;,</span>
<span class="c1">#             name=&quot;Google Introduces New AI Tools for Workspace&quot;,</span>
<span class="c1">#             content=&quot;Google has launched new AI ...&quot;,</span>
<span class="c1">#             content_md5=&quot;3a9a118392776e9dbcb4f6feb43dbaf0&quot;,</span>
<span class="c1">#             metadata={},</span>
<span class="c1">#             created_at=None,</span>
<span class="c1">#             updated_at=None,</span>
<span class="c1">#         ),</span>
<span class="c1">#         0.22798193991184235,</span>
<span class="c1">#     ),</span>
<span class="c1"># ]</span>
</code></pre></div>
<h3 id="usage-in-api-server">Usage in API Server</h3>
<ol>
<li>
<p>Start the FastAPI server:
   <div class="highlight"><pre><span></span><code><span class="nv">DB_PATH</span><span class="o">=</span>&lt;path/to/duckdb&gt;<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>run-server-dev<span class="w"> </span><span class="nv">DB_PATH</span><span class="o">=</span><span class="nv">$DB_PATH</span>
</code></pre></div></p>
</li>
<li>
<p>Access the API documentation:
   Open your browser and navigate to <code>http://localhost:8000/docs</code> for the Swagger UI.</p>
</li>
<li>
<p>Make API requests:</p>
</li>
<li>Single search: <code>POST /search</code> or <code>POST /s</code></li>
<li>Bulk search: <code>POST /bulk_search</code> or <code>POST /bs</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">base64</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="nb">print</span>

<span class="c1"># Query text search</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;http://localhost:8000/search&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;AMD yes!&quot;</span><span class="p">,</span> <span class="s2">&quot;top_k&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;results&#39;: [</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;point&#39;: {</span>
<span class="c1">#                 &#39;point_id&#39;: &#39;pt-bac54213-f476-4fb0-9813-24492135ad85&#39;,</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-18610658-cf88-4a53-b2ac-7e47e16465a5&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;1fc96c3d1916da4075947eb136673c16&#39;,</span>
<span class="c1">#                 &#39;embedding&#39;: [],</span>
<span class="c1">#                 &#39;metadata&#39;: {}</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;document&#39;: {</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-18610658-cf88-4a53-b2ac-7e47e16465a5&#39;,</span>
<span class="c1">#                 &#39;name&#39;: &#39;348.txt&#39;,</span>
<span class="c1">#                 &#39;content&#39;: &#39;Game makers get Xbox 2 sneak peek...&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;1fc96c3d1916da4075947eb136673c16&#39;,</span>
<span class="c1">#                 &#39;metadata&#39;: {&#39;file&#39;: &#39;348.txt&#39;, &#39;content_length&#39;: 2589},</span>
<span class="c1">#                 &#39;created_at&#39;: 1733371367,</span>
<span class="c1">#                 &#39;updated_at&#39;: 1733371367</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;relevance_score&#39;: 0.31964972615242004</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;point&#39;: {</span>
<span class="c1">#                 &#39;point_id&#39;: &#39;pt-7bcba958-ce5b-4d0d-b9d4-7b4fe4ec77cd&#39;,</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-de784541-a0fa-430b-9376-44bbbec8ccd4&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;878e78314cc8e162642b3d9028c6e0d2&#39;,</span>
<span class="c1">#                 &#39;embedding&#39;: [],</span>
<span class="c1">#                 &#39;metadata&#39;: {}</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;document&#39;: {</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-de784541-a0fa-430b-9376-44bbbec8ccd4&#39;,</span>
<span class="c1">#                 &#39;name&#39;: &#39;329.txt&#39;,</span>
<span class="c1">#                 &#39;content&#39;: &#39;Intel unveils laser breakthrough...&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;878e78314cc8e162642b3d9028c6e0d2&#39;,</span>
<span class="c1">#                 &#39;metadata&#39;: {&#39;file&#39;: &#39;329.txt&#39;, &#39;content_length&#39;: 2883},</span>
<span class="c1">#                 &#39;created_at&#39;: 1733371367,</span>
<span class="c1">#                 &#39;updated_at&#39;: 1733371367</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;relevance_score&#39;: 0.3183119297027588</span>
<span class="c1">#         },</span>
<span class="c1">#         {</span>
<span class="c1">#             &#39;point&#39;: {</span>
<span class="c1">#                 &#39;point_id&#39;: &#39;pt-a0032c53-362a-4caf-8db7-ed1559450e8f&#39;,</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-cc036752-b5e7-4729-85c7-dc09a3f18d34&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;5bf7dc32f230d0f427faec2ae3aa5b48&#39;,</span>
<span class="c1">#                 &#39;embedding&#39;: [],</span>
<span class="c1">#                 &#39;metadata&#39;: {}</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;document&#39;: {</span>
<span class="c1">#                 &#39;document_id&#39;: &#39;doc-cc036752-b5e7-4729-85c7-dc09a3f18d34&#39;,</span>
<span class="c1">#                 &#39;name&#39;: &#39;019.txt&#39;,</span>
<span class="c1">#                 &#39;content&#39;: &#39;Intel unveils laser breakthrough...&#39;,</span>
<span class="c1">#                 &#39;content_md5&#39;: &#39;5bf7dc32f230d0f427faec2ae3aa5b48&#39;,</span>
<span class="c1">#                 &#39;metadata&#39;: {&#39;file&#39;: &#39;019.txt&#39;, &#39;content_length&#39;: 2875},</span>
<span class="c1">#                 &#39;created_at&#39;: 1733371367,</span>
<span class="c1">#                 &#39;updated_at&#39;: 1733371367</span>
<span class="c1">#             },</span>
<span class="c1">#             &#39;relevance_score&#39;: 0.31670358777046204</span>
<span class="c1">#         }</span>
<span class="c1">#     ]</span>
<span class="c1"># }</span>


<span class="c1"># Query array search</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">()</span>
    <span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;Play Nintendo Switch&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">512</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">.</span><span class="n">embedding</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;http://localhost:8000/search&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">vector</span><span class="p">},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>


<span class="c1"># Query array in base64</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">openai</span><span class="o">.</span><span class="n">OpenAI</span><span class="p">()</span>
    <span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;IBM is a company&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">512</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">.</span><span class="n">embedding</span>
<span class="p">)</span>
<span class="n">vector_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
    <span class="s2">&quot;ascii&quot;</span>
<span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;http://localhost:8000/search&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">vector_base64</span><span class="p">},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

<span class="c1"># Bulk search</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;http://localhost:8000/bulk_search&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;queries&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;PlayStation 2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;Xbox 360&quot;</span><span class="p">}]},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="c1"># {&quot;results&quot;: [{&quot;results&quot;: [...]}, {&quot;results&quot;: [...]}]}</span>
</code></pre></div>
<h2 id="license">License</h2>
<p>This project is licensed under the MIT License. See the <a href="LICENSE">LICENSE</a> file for details.</p>
<h2 id="contributing">Contributing</h2>
<p>Contributions are welcome! Please feel free to submit a Pull Request.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>